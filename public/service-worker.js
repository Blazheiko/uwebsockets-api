(function(){"use strict";const c="EasyChat-"+1762953121402,s=["/","/manifest.json","/favicon.svg","/icons/badge-72.png","/icons/icon_192x192.png","/icons/icon_512x512.png","/audio/notification.mp3","/audio/notification_1.mp3","/audio/click-button-140881.mp3","/audio/pdjyznja.mp3"];self.addEventListener("install",function(t){console.log("[ServiceWorker] Install"),t.waitUntil(caches.open(c).then(function(e){return console.log("[ServiceWorker] Caching app shell"),e.addAll(s)})),self.skipWaiting()}),self.addEventListener("activate",function(t){return console.log("[ServiceWorker] Activate"),t.waitUntil(caches.keys().then(function(e){return Promise.all(e.map(function(n){if(n!==c)return console.log("[ServiceWorker] Removing old cache",n),r("NEW_VERSION"),caches.delete(n)}))})),self.clients.claim()}),self.addEventListener("fetch",function(t){console.log("[ServiceWorker] Fetch",t.request.url),t.request.url.includes("/icons/")||t.request.url.includes("/audio/")||t.request.url.includes("manifest.json")||t.request.url.includes("favicon.svg")||t.request.url.includes(".css")||t.request.url.includes("/assets/")?t.respondWith(caches.match(t.request).then(function(e){return e||fetch(t.request).then(function(n){if(n.status===200){const i=n.clone();caches.open(c).then(function(o){o.put(t.request,i)})}return n})})):t.request.url.includes("/api/")?t.respondWith(fetch(t.request).then(function(e){return e}).catch(function(){return caches.match(t.request).then(function(e){return e||new Response("Network error",{status:503})})})):t.request.mode==="navigate"||t.request.destination==="document"?t.respondWith(fetch(t.request).then(function(e){if(e.status===200){const n=e.clone();caches.open(c).then(function(i){i.put(t.request,n)})}return e}).catch(function(){return caches.match(t.request).then(function(e){return e||caches.match("/").then(function(n){return n||new Response("Offline",{status:503})})})})):t.respondWith(caches.match(t.request,{ignoreSearch:!0}).then(function(e){const n=fetch(t.request).then(function(i){if(i.status===200){const o=i.clone();caches.open(c).then(function(l){l.put(t.request,o)})}return i});return e||n}))});function a(t,e){return new Promise(function(){t.postMessage(e)})}function r(t){self.clients.matchAll().then(e=>{e.forEach(n=>{a(n,t)})})}self.addEventListener("message",t=>{t&&t.data&&t.data.message&&console.log("SW MESSAGE: ",t.data.message,t.data.data)}),self.addEventListener("push",t=>{console.log("[ServiceWorker] Push received:",t);let e={body:"You have a new message",icon:"/icons/icon_192x192.png",badge:"/icons/badge-72.png",vibrate:[200,100,200],data:{url:"/"},requireInteraction:!1,actions:[{action:"open",title:"Open App"},{action:"close",title:"Close"}]};if(t.data)try{const i=t.data.json();i.notification&&(e={...e,...i.notification}),i.data&&(e.data={...e.data,...i.data})}catch{console.log("[ServiceWorker] Push payload not JSON:",t.data.text()),e.body=t.data.text()||e.body}const n=e.title||"Easy Chat";t.waitUntil(self.registration.showNotification(n,e))}),self.addEventListener("notificationclick",t=>{console.log("[ServiceWorker] Notification clicked:",t),t.notification.close();const e=t.notification.data&&t.notification.data.url?t.notification.data.url:"/";t.action!=="close"&&t.waitUntil(self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(n=>{for(let i=0;i<n.length;i++){const o=n[i];if(o.url.includes(e)&&"focus"in o)return o.focus()}if(self.clients.openWindow)return self.clients.openWindow(e)}))}),self.addEventListener("notificationclose",t=>{console.log("[ServiceWorker] Notification closed:",t)})})();
